@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Safe Area Insets - iOS and Android */
    /* Support for both env() (modern) and constant() (iOS 11.0-11.2) */
    --safe-area-inset-top: env(safe-area-inset-top, constant(safe-area-inset-top, 0px));
    --safe-area-inset-right: env(safe-area-inset-right, constant(safe-area-inset-right, 0px));
    --safe-area-inset-bottom: env(safe-area-inset-bottom, constant(safe-area-inset-bottom, 0px));
    --safe-area-inset-left: env(safe-area-inset-left, constant(safe-area-inset-left, 0px));
  }

  /* Global Scrollbar - Slim and invisible by default */
  * {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
  }

  *:hover {
    scrollbar-color: rgb(75 85 99 / 0.5) transparent;
  }

  *::-webkit-scrollbar {
    width: 4px;
    height: 4px;
  }

  *::-webkit-scrollbar-track {
    background: transparent;
  }

  *::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 4px;
  }

  *:hover::-webkit-scrollbar-thumb {
    background: rgb(75 85 99 / 0.5);
  }

  html {
    @apply antialiased overflow-hidden;
    /* Ensure safe area is respected on mobile browsers */
    height: 100%;
    height: -webkit-fill-available;
  }

  body {
    @apply bg-background dark:bg-background-dark text-text dark:text-text-dark overflow-hidden;
    /* Ensure safe area is respected on mobile browsers */
    min-height: 100%;
    min-height: -webkit-fill-available;
    min-height: 100dvh;
  }
}

@layer components {
  .btn {
    @apply inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none;
  }

  .btn-primary {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500;
  }

  .btn-secondary {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500;
  }

  .input {
    @apply block w-full rounded-md border-border dark:border-border-dark bg-background dark:bg-background-dark text-text dark:text-text-dark focus:border-primary-500 focus:ring-primary-500 text-base sm:text-sm;
  }

  .label {
    @apply block text-sm font-medium text-text dark:text-text-dark;
  }

  .card {
    @apply rounded-lg bg-card dark:bg-card-dark border border-border dark:border-border-dark shadow-sm;
  }
}

@layer components {
  /* Date Range Picker Styles */
  .date-range-picker {
    @apply text-text dark:text-text-dark;
  }

  .date-range-picker .rdp {
    @apply m-0;
  }

  .date-range-picker .rdp-month {
    @apply space-y-2;
  }

  .date-range-picker .rdp-caption {
    @apply hidden;
  }

  .date-range-picker .rdp-caption_label {
    @apply hidden;
  }

  .date-range-picker .rdp-nav {
    @apply hidden;
  }

  .date-range-picker .rdp-button_previous,
  .date-range-picker .rdp-button_next {
    @apply hidden;
  }

  .date-range-picker .rdp-weekdays {
    @apply flex;
  }

  .date-range-picker .rdp-weekday {
    @apply text-xs text-gray-500 dark:text-gray-400 w-8 h-8 flex items-center justify-center font-normal;
  }

  .date-range-picker .rdp-week {
    @apply flex;
  }

  .date-range-picker .rdp-day {
    @apply w-8 h-8 text-sm rounded-md flex items-center justify-center transition-colors cursor-pointer;
    @apply text-text dark:text-text-dark;
    @apply touch-manipulation;
  }

  @media (max-width: 640px) {
    .date-range-picker .rdp-day {
      @apply w-9 h-9;
    }
  }

  .date-range-picker .rdp-day:hover:not(.rdp-day_disabled):not(.rdp-day_selected) {
    @apply bg-primary-100 dark:bg-primary-900/30;
  }

  .date-range-picker .rdp-day_selected {
    @apply bg-primary-500 text-white dark:bg-primary-400;
  }

  .date-range-picker .rdp-day_range_start {
    @apply bg-primary-500 text-white rounded-l-md;
  }

  .date-range-picker .rdp-day_range_end {
    @apply bg-primary-500 text-white rounded-r-md;
  }

  .date-range-picker .rdp-day_range_middle {
    @apply bg-primary-100 dark:bg-primary-900/30 text-primary-900 dark:text-primary-100;
  }

  .date-range-picker .rdp-day_today {
    @apply font-semibold;
  }

  .date-range-picker .rdp-day_outside {
    @apply text-gray-500 dark:text-gray-500 opacity-50;
  }

  .date-range-picker .rdp-day_disabled {
    @apply text-gray-500 dark:text-gray-500 opacity-30 cursor-not-allowed;
  }

  .date-range-picker .rdp-day_hidden {
    @apply invisible;
  }

  /* Date Range Picker Modal Animation */
  .date-range-picker-modal {
    animation: slideUpFromBottom 0.3s ease-out;
  }

  @media (min-width: 1024px) {
    .date-range-picker-modal {
      animation: fadeInScale 0.2s ease-out;
    }
  }

  @keyframes slideUpFromBottom {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
}

@layer utilities {
  /* Safe Area Padding Utilities */
  .pt-safe {
    padding-top: calc(1rem + var(--safe-area-inset-top));
  }

  .pb-safe {
    padding-bottom: calc(1rem + var(--safe-area-inset-bottom));
  }

  .pl-safe {
    padding-left: calc(1rem + var(--safe-area-inset-left));
  }

  .pr-safe {
    padding-right: calc(1rem + var(--safe-area-inset-right));
  }

  .px-safe {
    padding-left: calc(1rem + var(--safe-area-inset-left));
    padding-right: calc(1rem + var(--safe-area-inset-right));
  }

  .py-safe {
    padding-top: calc(1rem + var(--safe-area-inset-top));
    padding-bottom: calc(1rem + var(--safe-area-inset-bottom));
  }

  .p-safe {
    padding-top: calc(1rem + var(--safe-area-inset-top));
    padding-right: calc(1rem + var(--safe-area-inset-right));
    padding-bottom: calc(1rem + var(--safe-area-inset-bottom));
    padding-left: calc(1rem + var(--safe-area-inset-left));
  }

  /* Safe Area Margin Utilities */
  .mt-safe {
    margin-top: calc(1rem + var(--safe-area-inset-top));
  }

  .mb-safe {
    margin-bottom: calc(1rem + var(--safe-area-inset-bottom));
  }

  .ml-safe {
    margin-left: calc(1rem + var(--safe-area-inset-left));
  }

  .mr-safe {
    margin-right: calc(1rem + var(--safe-area-inset-right));
  }

  /* Safe Area Position Utilities */
  .top-safe {
    top: var(--safe-area-inset-top);
  }

  .bottom-safe {
    bottom: var(--safe-area-inset-bottom);
  }

  .left-safe {
    left: var(--safe-area-inset-left);
  }

  .right-safe {
    right: var(--safe-area-inset-right);
  }

  /* Safe Area with custom spacing */
  .top-safe-4 {
    top: calc(1rem + var(--safe-area-inset-top));
  }

  .top-safe-6 {
    top: calc(1.5rem + var(--safe-area-inset-top));
  }

  .bottom-safe-4 {
    bottom: calc(1rem + var(--safe-area-inset-bottom));
  }

  .bottom-safe-6 {
    bottom: calc(1.5rem + var(--safe-area-inset-bottom));
  }

  .right-safe-4 {
    right: calc(1rem + var(--safe-area-inset-right));
  }

  .right-safe-6 {
    right: calc(1.5rem + var(--safe-area-inset-right));
  }

  .left-safe-4 {
    left: calc(1rem + var(--safe-area-inset-left));
  }

  .left-safe-6 {
    left: calc(1.5rem + var(--safe-area-inset-left));
  }

  /* Safe Area Insets (no padding/margin, just the inset value) */
  .inset-safe-top {
    top: var(--safe-area-inset-top);
  }

  .inset-safe-bottom {
    bottom: var(--safe-area-inset-bottom);
  }

  .inset-safe-left {
    left: var(--safe-area-inset-left);
  }

  .inset-safe-right {
    right: var(--safe-area-inset-right);
  }

  .inset-safe-y {
    top: var(--safe-area-inset-top);
    bottom: var(--safe-area-inset-bottom);
  }

  .inset-safe-x {
    left: var(--safe-area-inset-left);
    right: var(--safe-area-inset-right);
  }

  .inset-safe {
    top: var(--safe-area-inset-top);
    right: var(--safe-area-inset-right);
    bottom: var(--safe-area-inset-bottom);
    left: var(--safe-area-inset-left);
  }
}

/* Flatpickr Custom Styles - Modern and Beautiful */
.flatpickr-calendar {
  @apply bg-card dark:bg-card-dark border border-border dark:border-border-dark text-text dark:text-text-dark;
  font-family: inherit;
  z-index: 999999 !important;
  border-radius: 12px !important;
  box-shadow:
    0 10px 25px -5px rgba(0, 0, 0, 0.1),
    0 8px 10px -6px rgba(0, 0, 0, 0.1) !important;
  padding: 8px !important;
  width: 340px !important;
  min-width: 340px !important;
  overflow: hidden;
}

.flatpickr-months {
  @apply bg-card dark:bg-card-dark;
  border-bottom: 1px solid;
  @apply border-border dark:border-border-dark;
  padding: 12px 12px 8px 12px !important;
  margin-bottom: 8px;
}

.flatpickr-month {
  @apply text-text dark:text-text-dark;
  position: relative;
  padding: 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  flex-direction: row !important;
  gap: 12px !important;
  width: 100% !important;
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
}

.flatpickr-current-month {
  @apply text-text dark:text-text-dark;
  font-size: 16px !important;
  font-weight: 600 !important;
  padding: 0 !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 6px !important;
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
  flex: 0 1 auto !important;
}

.flatpickr-current-month .flatpickr-monthDropdown-months,
.flatpickr-current-month .flatpickr-monthDropdown-years {
  @apply bg-background dark:bg-background-dark border border-border dark:border-border-dark;
  border-radius: 6px !important;
  padding: 4px 32px 4px 12px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  appearance: none !important;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
  background-repeat: no-repeat !important;
  background-position: right 10px center !important;
  background-size: 12px !important;
  height: 32px !important;
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

.flatpickr-current-month .flatpickr-monthDropdown-months {
  min-width: 123px !important;
  margin-right: 6px !important;
}

.flatpickr-current-month .flatpickr-monthDropdown-years {
  min-width: 130px !important;
  margin-left: 6px !important;
}

.flatpickr-current-month .flatpickr-monthDropdown-months:hover,
.flatpickr-current-month .flatpickr-monthDropdown-years:hover {
  @apply bg-gray-100 dark:bg-gray-800 border-primary-500 dark:border-primary-400;
}

.flatpickr-current-month .flatpickr-monthDropdown-months:focus,
.flatpickr-current-month .flatpickr-monthDropdown-years:focus {
  @apply outline-none ring-2 ring-primary-500 dark:ring-primary-400 ring-offset-1;
}

.flatpickr-prev-month,
.flatpickr-next-month {
  @apply text-text dark:text-text-dark;
  border-radius: 8px !important;
  width: 32px !important;
  height: 32px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  transition: all 0.2s ease !important;
  border: 1px solid transparent !important;
  flex-shrink: 0 !important;
  position: static !important;
  float: none !important;
  margin: 0 !important;
  min-width: 32px !important;
}


.flatpickr-month > * {
  flex-shrink: 0 !important;
}

.flatpickr-prev-month:hover,
.flatpickr-next-month:hover {
  @apply bg-gray-100 dark:bg-gray-800 border-border dark:border-border-dark;
  transform: scale(1.05);
}

.flatpickr-prev-month svg,
.flatpickr-next-month svg {
  width: 12px !important;
  height: 12px !important;
  fill: currentColor !important;
}

.flatpickr-weekdays {
  @apply bg-card dark:bg-card-dark;
  padding: 8px 4px 4px 4px !important;
  margin-bottom: 4px;
}

.flatpickr-weekday {
  @apply text-gray-600 dark:text-gray-400;
  font-weight: 600 !important;
  font-size: 12px !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px;
  padding: 8px 0 !important;
}

.flatpickr-days {
  padding: 4px !important;
}

.flatpickr-day {
  @apply text-text dark:text-text-dark;
  border-radius: 8px !important;
  border: 1px solid transparent !important;
  height: 36px !important;
  line-height: 36px !important;
  margin: 2px !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  transition: all 0.2s ease !important;
}

.flatpickr-day:hover {
  @apply bg-gray-100 dark:bg-gray-800;
  border-color: transparent !important;
  transform: scale(1.05);
}

.flatpickr-day.selected {
  @apply bg-primary-500 text-white;
  border-color: transparent !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4) !important;
}

.flatpickr-day.selected:hover {
  @apply bg-primary-600 text-white;
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5) !important;
}

.flatpickr-day.today {
  @apply border-primary-500;
  border-width: 2px !important;
  font-weight: 600 !important;
  background-color: transparent !important;
}

.flatpickr-day.today.selected {
  @apply bg-primary-500 text-white border-primary-500;
}

.flatpickr-day.flatpickr-disabled {
  @apply text-gray-400 dark:text-gray-600;
  opacity: 0.4 !important;
  cursor: not-allowed !important;
  background-color: transparent !important;
}

.flatpickr-day.flatpickr-disabled:hover {
  @apply bg-transparent;
  transform: none !important;
}

.flatpickr-day.prevMonthDay,
.flatpickr-day.nextMonthDay {
  @apply text-gray-400 dark:text-gray-600;
  opacity: 0.5 !important;
}

.flatpickr-day.prevMonthDay:hover,
.flatpickr-day.nextMonthDay:hover {
  @apply bg-gray-50 dark:bg-gray-900;
  opacity: 0.7 !important;
}

/* Weekend days styling (Saturday and Sunday) */
.flatpickr-day.weekend {
  @apply bg-rose-50 dark:bg-rose-950/30;
  color: #dc2626 !important; /* red-600 */
}

.dark .flatpickr-day.weekend {
  color: #f87171 !important; /* red-400 */
}

.flatpickr-day.weekend:hover {
  @apply bg-rose-100 dark:bg-rose-900/40;
  color: #b91c1c !important; /* red-700 */
}

.dark .flatpickr-day.weekend:hover {
  color: #fca5a5 !important; /* red-300 */
}

.flatpickr-day.weekend.selected {
  @apply bg-rose-500 text-white;
  color: white !important;
}

.flatpickr-day.weekend.selected:hover {
  @apply bg-rose-600 text-white;
}

.flatpickr-day.weekend.today {
  @apply border-rose-500;
  border-width: 2px !important;
  background-color: rgba(244, 63, 94, 0.1) !important; /* rose-500 with opacity */
}

.dark .flatpickr-day.weekend.today {
  background-color: rgba(244, 63, 94, 0.2) !important;
}

.flatpickr-day.weekend.today.selected {
  @apply bg-rose-500 text-white border-rose-500;
}

/* Ensure calendar appears above all elements */
.flatpickr-calendar.open {
  z-index: 999999 !important;
}

.flatpickr-calendar.animate.open {
  z-index: 999999 !important;
  animation: flatpickrFadeIn 0.2s ease-out !important;
}

@keyframes flatpickrFadeIn {
  from {
    opacity: 0;
    transform: translateY(-8px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Improve calendar container spacing */
.flatpickr-calendar .flatpickr-innerContainer {
  padding: 4px !important;
}

/* Better focus states */
.flatpickr-day:focus {
  outline: 2px solid;
  @apply outline-primary-500 dark:outline-primary-400;
  outline-offset: 2px;
}

/* Month and Year Dropdown Styles */
.flatpickr-monthDropdown-months,
.flatpickr-monthDropdown-years {
  @apply bg-background dark:bg-background-dark border border-border dark:border-border-dark text-text dark:text-text-dark;
  border-radius: 6px !important;
  padding: 4px 32px 4px 12px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  appearance: none !important;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
  background-repeat: no-repeat !important;
  background-position: right 10px center !important;
  background-size: 12px !important;
  height: 32px !important;
  margin: 0 2px 0 2px !important;
  display: inline-block !important;
  vertical-align: middle !important;
}

.flatpickr-monthDropdown-months {
  min-width: 123px !important;
}

.flatpickr-monthDropdown-years {
  min-width: 130px !important;
}


.flatpickr-month .flatpickr-prev-month,
.flatpickr-month .flatpickr-current-month,
.flatpickr-month .flatpickr-next-month {
  display: inline-flex !important;
  vertical-align: middle !important;
}

.flatpickr-monthDropdown-months:hover,
.flatpickr-monthDropdown-years:hover {
  @apply bg-gray-100 dark:bg-gray-800 border-primary-500 dark:border-primary-400;
}

.flatpickr-monthDropdown-months:focus,
.flatpickr-monthDropdown-years:focus {
  @apply outline-none ring-2 ring-primary-500 dark:ring-primary-400 ring-offset-1;
}

/* Dark mode arrow color */
.dark .flatpickr-monthDropdown-months,
.dark .flatpickr-monthDropdown-years {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ccc' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
}



/* Show year text by default */
.flatpickr-current-month .cur-year {
  display: inline-block !important;
  margin-left: 4px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Hide year text only if dropdown exists */
.flatpickr-current-month .flatpickr-monthDropdown-years ~ .cur-year,
.flatpickr-current-month:has(.flatpickr-monthDropdown-years) .cur-year {
  display: none !important;
}
